(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{111:function(t,e,s){"use strict";var i=s(0),n=s.n(i),h=s(15),o=Object(h.d)({ButtonGroup:t=>({display:t.inline?"inline-flex":"flex",flexWrap:"wrap",margin:"0 0.25rem","&>*":{flex:"1 1 auto","&:not(:first-child)":{borderTopLeftRadius:0,borderBottomLeftRadius:0},"&:not(:last-child)":{borderTopRightRadius:0,borderBottomRightRadius:0}}})});e.a=function(t){const{children:e,inline:s}=t,i=o({inline:s});return n.a.createElement("div",{className:i.ButtonGroup},e)}},169:function(t,e,s){"use strict";s.r(e);class i{constructor(...t){2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]?this.set(t[0],t[1]):1===t.length&&t[0]instanceof i&&this.set(t[0])}set(...t){let e=0,s=0;1===t.length?t[0]instanceof i&&(e=t[0].x,s=t[0].y):2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&(e=t[0],s=t[1]),this.x=e,this.y=s}scale(t){return this.x*=t,this.y*=t,this}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}getDistance(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}getCenter(t){return new i((this.x+t.x)/2,this.y/t.y/2)}static scale(t,e){const s=new i(t);return s.scale(e),s}static add(t,e){const s=new i(t);return s.add(e),s}static subtract(t,e){const s=new i(t);return s.subtract(e),s}}const n=new i(1150,6689),h=new i(3690,475),o=new i(3927,574);var a,c=s(12);!function(t){t[t.LEFT=0]="LEFT",t[t.MIDDLE=1]="MIDDLE",t[t.RIGHT=2]="RIGHT"}(a||(a={}));var r=s(21),l=s(32);class u extends class{constructor(t){this.position=new i(t)}setPosition(...t){2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]?this.position.set(t[0],t[1]):1===t.length&&t[0]instanceof i&&this.position.set(t[0])}getPosition(){return this.position}getX(){return this.position.x}getY(){return this.position.y}}{constructor(t,e,s){super(t),this.width=e,this.height=s}setDimensions(t,e){this.width=t,this.height=e}setWidth(t){this.width=t}setHeight(t){this.height=t}getWidth(){return this.width}getHeight(){return this.height}isPointInside(t){return t.x>=this.position.x&&t.x<=this.position.x+this.width&&t.y>=this.position.y&&t.y<=this.position.y+this.height}}var d=s(19),g=s(48);class p extends class{constructor(t,e=!1,s=!1){this.rect=t,this.draggable=e,this.debug=s,this.active=!1}setContext(t){this.context=t}setDebug(t){this.debug=t}setPosition(t){this.rect.setPosition(t)}getPosition(){return this.rect.getPosition()}update(t){}render(){if(this.debug){this.context.save();const t=`${Math.round(this.rect.getX())} - ${Math.round(this.rect.getY())}`,e=this.context.measureText(t).width;this.context.fillStyle="red",this.context.fillText(t,this.rect.getX()+(this.rect.getWidth()-e)/2,this.rect.getY()-20),this.context.lineWidth=1,this.context.strokeStyle="red",this.context.strokeRect(this.rect.getX(),this.rect.getY(),this.rect.getWidth(),this.rect.getHeight()),this.context.restore()}}isActive(){return this.active}onKeyDown(t){}onKeyUp(t){}onMouseMove(t){this.active&&this.rect.setPosition(t.x-this.rect.getWidth()/2,t.y-this.rect.getHeight()/2)}onMouseDown(t,e){this.draggable&&this.rect.isPointInside(e)&&(this.active=!0)}onMouseUp(t,e){this.draggable&&this.rect.isPointInside(e)&&(this.active=!1)}onDoubleClick(t){}}{constructor(t,e,s,i,n,h,o=!1){super(new u(e,n.w,n.h),!0,o),this.aliveRect=n,this.deadRect=h,this.updatePlayer(t,s),this.image=i,this.rect.setPosition(e)}updatePlayer(t,e){this.data=t,this.resetSectionId=e[0],this.deadSectionId=e[1],this.unusedSectionId=e[2],this.draggable=!0,t.section===this.deadSectionId?this.imageRect=this.deadRect:(this.imageRect=this.aliveRect,t.section===this.unusedSectionId&&(this.draggable=!1)),this.rect.setDimensions(this.imageRect.w,this.imageRect.h)}render(){if(super.render(),this.data.section!==this.unusedSectionId){if(this.context.save(),this.isActive()&&(this.context.shadowBlur=15,this.context.shadowColor="#C2D2E3"),""!=this.data.name){const t=this.context.measureText(this.data.name).width;this.context.fillStyle=l.a[this.data.color].base,this.context.fillText(this.data.name,this.rect.getX()+(this.rect.getWidth()-t)/2,this.rect.getY()-20)}this.context.drawImage(this.image,this.imageRect.x,this.imageRect.y,this.imageRect.w,this.imageRect.h,this.rect.getX(),this.rect.getY(),this.rect.getWidth(),this.rect.getHeight()),this.context.restore()}}onDoubleClick(t){if(this.rect.isPointInside(t)&&this.data.section!==this.unusedSectionId){const t=Object(c.f)(g.a.getState());let e=this.resetSectionId;this.data.section===this.deadSectionId?g.a.dispatch(Object(c.p)(t.map(t=>Object.assign(Object.assign({},t),{players:t.id===this.deadSectionId?[...t.players.filter(t=>t.id!==this.data.color)]:t.id===this.resetSectionId?[...t.players,{id:this.data.color}]:[...t.players]})))):(g.a.dispatch(Object(c.p)(t.map(t=>Object.assign(Object.assign({},t),{players:t.id!==this.deadSectionId?[...t.players.filter(t=>t.id!==this.data.color)]:[...t.players,{id:this.data.color}]})))),e=this.deadSectionId),g.a.dispatch(Object(d.h)({player:this.data.color,newSection:e}))}}}class f{constructor(){this.animFrame=0,this.width=0,this.height=0,this.miraHQ={name:"MiraHQ",image:new Image,scale:2},this.polus={name:"Polus",image:new Image,scale:4},this.theSkeld={name:"TheSkeld",image:new Image,scale:1},this.players=new Image,this.loading=0,this.theSkeld.image.src="assets/images/TheSkeld.png",this.miraHQ.image.src="assets/images/MiraHQ.png",this.polus.image.src="assets/images/Polus.png",this.players.src="assets/images/players.png",this.theSkeld.image.onload=()=>{this.loading+=.25},this.miraHQ.image.onload=()=>{this.loading+=.25},this.polus.image.onload=()=>{this.loading+=.25},this.players.onload=()=>{this.loading+=.25},this.currentMap=this.miraHQ,this.entities={},this.offset=new i(n),this.panning=!1,this.panningPosition=new i,this.scale=1,this.lastTouch=new i,this.lastTouchTime=0,this.lastTouchDistance=0;const t=g.a.getState(),e=Object(d.c)(t),s=Object(c.e)(t),h=Object(c.d)(t),o=Object(c.h)(t);for(const t in e){const n=e[t],a=r.b[t];this.entities[t+"Player"]=new p(n,new i,[s,h,o],this.players,a.alive,a.dead)}this.debug=!1,this.positions={screen:new i,map:new i}}static GetInstance(){return f.instance||(f.instance=new f),f.instance}setContext(t){this.context=t,this.width=this.context.canvas.width,this.height=this.context.canvas.height,this.forEachEntity(t=>(t.setContext(this.context),!0))}setTheme(t){this.theme=t}getAnimFrame(){return this.animFrame}setCurrentMap(t){if(t!==this.currentMap.name){switch(t){case"Polus":this.currentMap=this.polus,this.currentMap.scale=4,this.offset.set(h);break;case"TheSkeld":this.currentMap=this.theSkeld,this.currentMap.scale=1,this.offset.set(o);break;default:this.currentMap=this.miraHQ,this.currentMap.scale=2,this.offset.set(n)}this.setInitialPlayersPositions(),this.scale=1}}setDebug(t){this.debug=t,this.forEachEntity(e=>(e.setDebug(t),!0))}getCurrentMap(){return this.currentMap.name}onMouseMove(t){t.preventDefault(),this.handleMouseMove(this.getMousePosition(t))}onMouseDown(t){t.preventDefault(),this.handleMouseDown(t.button,this.getMousePosition(t))}onMouseUp(t){t.preventDefault(),this.handleMouseUp(t.button,this.getMousePosition(t))}onMouseLeave(t){if(t.preventDefault(),this.panning)this.panning=!1;else{const e=this.getMousePosition(t),s=this.screenToMap(e);this.forEachEntity(e=>(e.onMouseUp(t.button,s),!0))}}onDoubleClick(t){t.preventDefault(),this.handleDoubleClick(this.getMousePosition(t))}onWheel(t){this.handleZoom(-.01*t.deltaY,this.getMousePosition(t))}onTouchMove(t){if(t.preventDefault(),1===t.touches.length)this.handleMouseMove(this.getTouchPosition(t));else if(2===t.touches.length){const e=new i(this.getTouchPosition(t,0)),s=new i(this.getTouchPosition(t,1)),n=e.getDistance(s),h=e.getCenter(s);this.lastTouchDistance||(this.lastTouchDistance=n);const o=this.lastTouchDistance-n;o>0?this.handleZoom(.01,h):o<0&&this.handleZoom(-.01,h),this.lastTouchDistance=n}}onTouchStart(t){t.preventDefault(),1===t.touches.length&&this.handleMouseDown(a.LEFT,this.getTouchPosition(t))}onTouchEnd(t){if(t.preventDefault(),1===t.touches.length){const t=(new Date).getTime(),e=t-this.lastTouchTime;this.handleMouseUp(a.LEFT,this.lastTouch),e<500&&e>0&&this.handleDoubleClick(this.lastTouch),this.lastTouchTime=t}this.lastTouchDistance=0}onTouchCancel(t){t.preventDefault(),1===t.touches.length&&this.handleMouseUp(a.LEFT,this.lastTouch),this.lastTouchDistance=0}updatePlayers(){const t=g.a.getState(),e=Object(d.c)(t),s=Object(c.e)(t),i=Object(c.d)(t),n=Object(c.h)(t);for(const t of Object.keys(e)){const h=e[t];this.entities[t+"Player"].updatePlayer(h,[s,i,n])}}init(){if(void 0===this.context&&null===this.context||void 0===this.theme&&null===this.theme)throw new Error("Context and theme must be set before initializing the animation.");this.setInitialPlayersPositions(),this.loop(0)}checkOffset(){this.offset.x=Math.max(Math.min(this.offset.x,this.currentMap.image.width*this.scale*this.currentMap.scale-this.width),0),this.offset.y=Math.max(Math.min(this.offset.y,this.currentMap.image.height*this.scale*this.currentMap.scale-this.height),0)}screenToMap(t){const e=i.add(t,this.offset);return e.scale(1/this.scale),e}getMousePosition(t){const e=t.currentTarget.getBoundingClientRect();return new i((t.clientX-e.left)*(this.width/e.width),(t.clientY-e.top)*(this.height/e.height))}getTouchPosition(t,e=0){const s=t.currentTarget.getBoundingClientRect(),n=new i((t.touches[e].clientX-s.left)*(this.width/s.width),(t.touches[e].clientY-s.top)*(this.height/s.height));return this.lastTouch.set(n),n}forEachEntity(t){for(const e in this.entities)if(!t(this.entities[e]))break}handleMouseMove(t){this.panning?(this.offset.subtract(i.subtract(t,this.panningPosition)),this.panningPosition.set(t)):this.forEachEntity(e=>(e.onMouseMove(this.screenToMap(t)),!0));const e=this.screenToMap(t);this.positions.map.set(e),this.positions.screen.set(t)}handleMouseDown(t,e){let s=!0;this.forEachEntity(i=>(i.onMouseDown(t,this.screenToMap(e)),!i.isActive()||(s=!1,!1))),t===a.LEFT&&(this.panning=s,this.panningPosition.set(e))}handleMouseUp(t,e){this.panning?this.panning=!1:this.forEachEntity(s=>(s.onMouseUp(t,this.screenToMap(e)),!0))}handleDoubleClick(t){this.forEachEntity(e=>(e.onDoubleClick(this.screenToMap(t)),!0))}handleZoom(t,e){const s=this.screenToMap(e);this.scale+=t;const i=this.screenToMap(e);s.subtract(i),s.scale(this.scale),this.offset.add(s)}setInitialPlayersPositions(){const t=g.a.getState(),e=Object(d.c)(t);let s=-2;for(const t in e){const e=Math.PI/6*s,n=new i(this.offset);n.x+=this.width/2.3+Math.cos(e)*(this.width/5),n.y+=this.height/2.7+Math.sin(e)*(this.height/4),this.entities[t+"Player"].setPosition(n),s++}}renderDebug(){this.debug&&(this.context.strokeStyle="black",this.context.lineWidth=8,this.context.fillStyle="white",this.context.strokeText(`Screen: x = ${Math.round(this.positions.screen.x)} y = ${Math.round(this.positions.screen.y)}`,0,40),this.context.strokeText(`Map: x = ${Math.round(this.positions.map.x)} y = ${Math.round(this.positions.map.y)}`,0,100),this.context.strokeText(`Offset: x = ${Math.round(this.offset.x)} y = ${Math.round(this.offset.y)}`,0,160),this.context.fillText(`Screen: x = ${Math.round(this.positions.screen.x)} y = ${Math.round(this.positions.screen.y)}`,0,40),this.context.fillText(`Map: x = ${Math.round(this.positions.map.x)} y = ${Math.round(this.positions.map.y)}`,0,100),this.context.fillText(`Offset: x = ${Math.round(this.offset.x)} y = ${Math.round(this.offset.y)}`,0,160))}update(t){this.forEachEntity(e=>(e.update(t),!0))}render(){this.context.clearRect(0,0,this.width,this.height),this.loading<1?(this.context.fillStyle=this.theme.textColorPrimary,this.context.font="50px "+this.theme.fontFamily,this.context.fillText("Loading...",this.width/2-50,this.height/2-10)):(this.context.save(),this.context.translate(-this.offset.x,-this.offset.y),this.context.scale(this.scale,this.scale),this.context.save(),this.context.scale(this.currentMap.scale,this.currentMap.scale),this.context.drawImage(this.currentMap.image,0,0),this.context.restore(),this.forEachEntity(t=>(t.render(),!0)),this.context.restore(),this.renderDebug())}loop(t){m.update(t),m.render(),m.animFrame=window.requestAnimationFrame(m.loop)}}const m=f.GetInstance();var M=m,x=s(44),y=s(111),b=s(0),w=s.n(b),T=s(30),v=s(15),D=Object(v.d)(t=>({Map:{width:"100%",height:"100%",maxHeight:"calc((var(--vh, 1vh) * 100) - 9rem)",fallbacks:{maxHeight:"calc(100vh - 9rem)"},overscrollBehavior:"none",touchAction:"none"},MapImage:{display:"none"}}));var P=function(t){const e=D(),s=Object(v.f)(),i=t.currentMap,n=Object(T.c)(d.c),h=Object(T.c)(c.e),o=Object(T.c)(c.d),a=Object(T.c)(c.h),r=w.a.useRef(null);return w.a.useEffect(()=>{if(null!==r.current){const t=r.current.getContext("2d");if(null!=t)return M.setContext(t),M.setTheme(s),M.init(),()=>{cancelAnimationFrame(M.getAnimFrame())}}},[]),w.a.useEffect(()=>{M.setTheme(s)},[s]),w.a.useEffect(()=>{M.setCurrentMap(i)},[i]),w.a.useEffect(()=>{M.updatePlayers()},[n,h,o,a]),w.a.createElement("canvas",{ref:r,width:1920,height:1080,className:e.Map,onContextMenu:t=>t.preventDefault(),onMouseMove:t=>M.onMouseMove(t),onMouseDown:t=>M.onMouseDown(t),onMouseUp:t=>M.onMouseUp(t),onMouseLeave:t=>M.onMouseLeave(t),onDoubleClick:t=>M.onDoubleClick(t),onTouchMove:t=>M.onTouchMove(t),onTouchStart:t=>M.onTouchStart(t),onTouchEnd:t=>M.onTouchEnd(t),onTouchCancel:t=>M.onTouchCancel(t),onWheel:t=>M.onWheel(t)},"This section is not supported on your browser.")},E=s(26),S=Object(v.d)({Maps:{display:"flex",flexDirection:"column",justifyContent:"center",padding:"1rem",flexGrow:1},MapsHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},MapsTitle:{fontSize:"1.25rem",fontWeight:500,letterSpacing:"0.05em",marginRight:"1rem",flex:"1 0 auto"},MapsContainer:{flexGrow:1}}),k=s(99);e.default=function(){const t=Object(T.c)(E.b),[e,s]=w.a.useState(M.getCurrentMap()),i=S(),{t:n}=Object(k.a)();return w.a.createElement("div",{className:i.Maps},w.a.createElement("div",{className:i.MapsHeader},!t&&w.a.createElement("h2",{className:i.MapsTitle},n("maps.title")),w.a.createElement(y.a,{inline:!t},w.a.createElement(x.b,{pressed:"MiraHQ"===e,onClick:()=>s("MiraHQ")},"Mira HQ"),w.a.createElement(x.b,{pressed:"Polus"===e,onClick:()=>s("Polus")},"Polus"),w.a.createElement(x.b,{pressed:"TheSkeld"===e,onClick:()=>s("TheSkeld")},"The Skeld"))),w.a.createElement("div",{className:i.MapsContainer},w.a.createElement(P,{currentMap:e})))}}}]);